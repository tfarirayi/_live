<!--
Main application container element
@tfarirayi1
-->
<!-- Dependencies -->
<!-- Polymer dependency -->
<link rel="import" href="../bower_components/polymer/polymer.html">
<!-- App elements -->
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<!-- Iron elements -->
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<!-- Neon elements -->
<link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">
<!-- Paper elements -->
<link rel="import" href="../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-badge/paper-badge.html">
<link rel="import" href="../bower_components/paper-styles/shadow.html">
<!-- Google fonts -->
<link href='//fonts.googleapis.com/css?family=Arvo|Space+Mono|Raleway|Roboto|Source+Code+Pro' rel='stylesheet'>
<!-- Custom elements -->
<link rel="import" href="my-icons.html">
<link rel="import" href="my-styles.html">

<dom-module id="my-app">
<template>
    <style include="my-styles">
        :host {
            @apply(--layout-fullbleed);
            @apply(--layout-vertical);
        }

        app-header {
            background-color: rgba(207,216,220 ,0.9);
            border-radius: 0px 0px 8px 8px;
            border: 1px solid rgba(255,138,101 ,0.7);   
            border-top: none;                      
            color: rgba(55,71,79 ,1);
            height: 124px;
            @apply(--shadow-elevation-4dp);
        }
       
        app-toolbar.top-bar {
            color: rgba(38,50,56 ,1);
            height: 64px;
            text-shadow: 1px 1px rgba(255,138,101 ,0.8);
            @apply(--layout-horizontal);
            @apply(--layout-end);
            @apply(--layout-center-justified);
        }

        app-toolbar.bottom-bar {
            height: 58px;
            @apply(--layout-horizontal);
            @apply(--layout-center);
            @apply(--layout-center-justified);
        }

        paper-button.home-button, a {
            color: inherit;
            font-family: 'Space Mono', monospace;
            font-size: 19px;
            padding: 0px;
            text-align: center;
            text-decoration: none;
            text-transform: none;
        }

        paper-button.home-button {
            @apply(--layout-vertical);  
        }
        
        paper-button.home-button:focus, a:focus {
            font-weight: normal;
            text-decoration: none;
        }

        .main-title {
            line-height: 120%;
        }
    </style>
    <!-- Local dom here -->
        <!-- Routing -->
        <app-location route="{{route}}"></app-location>
        <app-route
            route="{{route}}"
            pattern="/:page"
            data="{{routeData}}"
            tail="{{tail}}">
        </app-route>

            <!-- Header Layout Container -->
            <app-header-layout effects="blend-background" fullbleed>
                <app-header id="header" condenses fixed>
                <!-- Toolbar Top -->
                <app-toolbar class="top-bar">
                    <div class="bottom main-title">
                        <a href="/home" tabindex="-1">
                            <paper-button class="home-button" noink><span class="logo">Orange House</span><span class="logo">Academy&trade; </span></paper-button>
                        </a>
                    </div>
                </app-toolbar>
                <!-- Toolbar Bottom -->
                <app-toolbar class="bottom-bar" sticky>
                    <a href="/info" class="top-icon">
                        <iron-icon icon="my-icons:info-outline"></iron-icon>
                    </a>
                    <a href="/phone" class="top-icon">
                        <iron-icon icon="my-icons:phone-iphone"></iron-icon>
                    </a>
                    <a href="/message" class="top-icon">
                        <iron-icon icon="my-icons:mail"></iron-icon>
                    </a>
                </app-toolbar>
                </app-header>

                    <!-- Routing Display -->
                    <iron-pages id="content"
                        attr-for-selected="id" 
                        fallback-selection="home" 
                        selected="[[page]]">

                        <home-page id="home" loading></home-page>
                        <ebooking-page id="ebooking" loading></ebooking-page>
                        <eshop-page id="eshop" loading></eshop-page>
                        <regular-page id="regular" loading></regular-page>
                        <message-page id="message" loading></message-page>
                        
                    </iron-pages>
                    <!-- Push footer to bottom --> 
                    <span class="spacer"></span>
                    <div id="footer" class="my-footer" loading>
                        <span class="footer-date">&copy; [[year]]</span> 
                        <span class="footer-text">Orange House<br>Web Academy&trade;</span>
                    </div>
            </app-header-layout>

</template>
    <script>
        Polymer ({
            is: 'my-app',

            behaviors: [
                Polymer.NeonAnimationRunnerBehavior
            ],

            properties: {

                animationConfig: {
                    value: function() {
                        return {
                            'entry': {
                                name: 'fade-in-animation',
                                node: this.$.home,
                                timing: {
                                    duration: 2000
                                }
                            }
                        }
                    }
                },

                page: {
                    type: String,
                    reflectToAttribute: true,
                    observer: '_pageChanged'
                },

                year: {
                    type: String,
                    value: function() {
                        var date = new Date();
                        return date.getFullYear();
                    }
                }
            },

            observers: [
                '_routePageChanged(routeData.page)'
            ],

            listeners: {
                'neon-animation-finish': '_animationFinish'
            },


            created: function() {
                Polymer.RenderStatus.afterNextRender(this, function() {
                    this.importHref(this.resolveUrl('lazy-resources.html'), null, null, true);
                });
            },

            ready: function() {
                this.playAnimation('entry');
            },

            _animationFinish: function() {
                this.removeAttribute('loading');
                
            },

            _pageChanged: function(page) {
                var resolvedPageUrl = this.resolveUrl(page + '-page.html');
                var main = this;
                main.$.footer.setAttribute('loading', '');
                this.importHref(resolvedPageUrl, function() {
                    main.$.footer.removeAttribute('loading');
                }, this._show404, true);
                // Scroll to top on page change
                this.$.header.scroll({top: 0});
            },

            _routePageChanged: function(page) {
                // Set to home page if page is undefined
                this.page = page || 'home';
            },

            _show404: function() {
                this.page = 'home';
            }

        });
    </script>
</dom-module>
